<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Multiplayer Pong</title>
<style>
  canvas {
    background: black;
    display: block;
    margin: 20px auto;
    border: 2px solid white;
  }
</style>
</head>
<body>
<canvas id="pong" width="600" height="300"></canvas>

<script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
<script>
  const socket = io('http://localhost:3000'); // adapt if server runs elsewhere

  const canvas = document.getElementById('pong');
  const ctx = canvas.getContext('2d');

  const paddleWidth = 10;
  const paddleHeight = 70;
  const ballRadius = 10;

  let players = {};
  let ball = { x: 300, y: 150 };

  // Local paddle info
  let localPaddle = null;
  let paddleY = canvas.height / 2 - paddleHeight / 2;

  // Receive initial game state
  socket.on('init', ({ players: initPlayers, ball: initBall }) => {
    players = initPlayers;
    ball = initBall;
    localPaddle = players[socket.id] ? players[socket.id].side : null;
  });

  // Update players (paddles) positions
  socket.on('playersUpdate', (currentPlayers) => {
    players = currentPlayers;
  });

  // Update game state (ball and paddles)
  socket.on('gameState', (state) => {
    players = state.players;
    ball = state.ball;
    draw();
  });

  // Send paddle movement to server on mouse move
  canvas.addEventListener('mousemove', (e) => {
    const rect = canvas.getBoundingClientRect();
    let mouseY = e.clientY - rect.top;
    // Clamp paddle inside canvas
    paddleY = Math.max(0, Math.min(canvas.height - paddleHeight, mouseY - paddleHeight / 2));
    if (localPaddle && players[socket.id]) {
      socket.emit('paddleMove', paddleY);
      players[socket.id].paddleY = paddleY;
    }
    draw();
  });

  // Draw everything on canvas
  function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    // Draw ball
    ctx.fillStyle = 'white';
    ctx.beginPath();
    ctx.arc(ball.x, ball.y, ballRadius, 0, Math.PI * 2);
    ctx.fill();

    // Draw paddles
    for (const id in players) {
      let p = players[id];
      let x = p.side === 'left' ? 0 : canvas.width - paddleWidth;
      ctx.fillRect(x, p.paddleY, paddleWidth, paddleHeight);
    }
  }

  // Initial draw
  draw();
</script>
</body>
</html>
